<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>spring-ioc &amp; aop | Du Yao&#39;s blog | Make progress step by step</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="spring">
    <meta name="description" content="spring知识点http://jinnianshilongnian.iteye.com/blog/1482071 Spring注入方式Spring注入是指在启动Spring容器加载bean配置的时候，完成对变量的赋值行为  设值注入 构造注入  设值注入通过set方法进行注入 spring-injection.xml12345&amp;lt;bean id=&amp;quot;injectionService&amp;">
<meta name="keywords" content="spring">
<meta property="og:type" content="article">
<meta property="og:title" content="spring-ioc &amp; aop">
<meta property="og:url" content="http://duyao.github.io/2017/03/18/spring-ioc-aop/index.html">
<meta property="og:site_name" content="Du Yao&#39;s blog">
<meta property="og:description" content="spring知识点http://jinnianshilongnian.iteye.com/blog/1482071 Spring注入方式Spring注入是指在启动Spring容器加载bean配置的时候，完成对变量的赋值行为  设值注入 构造注入  设值注入通过set方法进行注入 spring-injection.xml12345&amp;lt;bean id=&amp;quot;injectionService&amp;">
<meta property="og:image" content="http://7xilc8.com1.z0.glb.clouddn.com/aop.png">
<meta property="og:image" content="http://7xilc8.com1.z0.glb.clouddn.com/advice-charater.png">
<meta property="og:image" content="http://7xilc8.com1.z0.glb.clouddn.com/spring-datasource.png">
<meta property="og:image" content="http://7xilc8.com1.z0.glb.clouddn.com/transaction_propagation.png">
<meta property="og:updated_time" content="2017-05-13T14:35:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="spring-ioc &amp; aop">
<meta name="twitter:description" content="spring知识点http://jinnianshilongnian.iteye.com/blog/1482071 Spring注入方式Spring注入是指在启动Spring容器加载bean配置的时候，完成对变量的赋值行为  设值注入 构造注入  设值注入通过set方法进行注入 spring-injection.xml12345&amp;lt;bean id=&amp;quot;injectionService&amp;">
<meta name="twitter:image" content="http://7xilc8.com1.z0.glb.clouddn.com/aop.png">
    
        <link rel="alternative" href="/atom.xml" title="Du Yao&#39;s blog" type="application/atom+xml">
    
    <link rel="shortcut icon" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/style.css?v=1.4.8">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/yao.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Du Yao</h5>
          <a href="mailto:duyao_dy@163.com" title="duyao_dy@163.com" class="mail">duyao_dy@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/duyao" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about" target="_blank" >
                <i class="icon icon-lg icon-link"></i>
                About
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">spring-ioc &amp; aop</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">spring-ioc &amp; aop</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-03-18T10:26:58.000Z" itemprop="datePublished" class="page-time">
  2017-03-18
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/note/">note</a></li></ul>

            
        </h5>
    </div>

    

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#spring知识点"><span class="post-toc-number">1.</span> <span class="post-toc-text">spring知识点</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Spring注入方式"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">Spring注入方式</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设值注入"><span class="post-toc-number">1.1.1.</span> <span class="post-toc-text">设值注入</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#构造注入"><span class="post-toc-number">1.1.2.</span> <span class="post-toc-text">构造注入</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Bean的配置项"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">Bean的配置项</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Bean作用域"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">Bean作用域</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Bean的生命周期"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">Bean的生命周期</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#初始化"><span class="post-toc-number">1.4.1.</span> <span class="post-toc-text">初始化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#销毁"><span class="post-toc-number">1.4.2.</span> <span class="post-toc-text">销毁</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置全局的初始化销毁方法"><span class="post-toc-number">1.4.3.</span> <span class="post-toc-text">配置全局的初始化销毁方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#例子"><span class="post-toc-number">1.4.4.</span> <span class="post-toc-text">例子</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#总结"><span class="post-toc-number">1.4.5.</span> <span class="post-toc-text">总结</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Aware"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">Aware</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Bean的自动装配-Autowiring"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">Bean的自动装配(Autowiring)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#例子-1"><span class="post-toc-number">1.6.1.</span> <span class="post-toc-text">例子</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ioc原理"><span class="post-toc-number">2.</span> <span class="post-toc-text">ioc原理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#BeanFactory-的构造与执行"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">BeanFactory 的构造与执行</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ApplicationContext-的构造和执行"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">ApplicationContext 的构造和执行</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#AOP（Aspect-Orient-Programming）"><span class="post-toc-number">3.</span> <span class="post-toc-text">AOP（Aspect Orient Programming）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#SpringAOP"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">SpringAOP</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#一些概念"><span class="post-toc-number">3.1.1.</span> <span class="post-toc-text">一些概念</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#advice、pointcut、aspect"><span class="post-toc-number">3.1.1.1.</span> <span class="post-toc-text">advice、pointcut、aspect</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Introduction"><span class="post-toc-number">3.1.1.2.</span> <span class="post-toc-text">Introduction</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Advisor"><span class="post-toc-number">3.1.1.3.</span> <span class="post-toc-text">Advisor</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#AspectJ"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">AspectJ</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#spring对AspectJ的支持"><span class="post-toc-number">3.2.1.</span> <span class="post-toc-text">spring对AspectJ的支持</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#配置方式"><span class="post-toc-number">3.2.1.1.</span> <span class="post-toc-text">配置方式</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#动态代理技术"><span class="post-toc-number">4.</span> <span class="post-toc-text">动态代理技术</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#JDK使用反射技术创建动态代理"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">JDK使用反射技术创建动态代理</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#CGLib动态代理基本原理"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">CGLib动态代理基本原理</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#事务管理"><span class="post-toc-number">5.</span> <span class="post-toc-text">事务管理</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#PlatformTransactionManager事务管理器"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">PlatformTransactionManager事务管理器</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TransactionDefinition事务定义信息"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">TransactionDefinition事务定义信息</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#事务隔离级别"><span class="post-toc-number">5.2.1.</span> <span class="post-toc-text">事务隔离级别</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#事务的传播特性"><span class="post-toc-number">5.2.2.</span> <span class="post-toc-text">事务的传播特性</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#TransactionStatus事务状态信息"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">TransactionStatus事务状态信息</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置声明式事务"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">配置声明式事务</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#xml方式"><span class="post-toc-number">5.4.1.</span> <span class="post-toc-text">xml方式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#注解"><span class="post-toc-number">5.4.2.</span> <span class="post-toc-text">注解</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#一些问题"><span class="post-toc-number">6.</span> <span class="post-toc-text">一些问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#spring为什么默认为单例"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">spring为什么默认为单例</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#spring保证线程安全吗"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">spring保证线程安全吗</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-spring-ioc-aop"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">spring-ioc & aop</h1>
        <div class="post-meta">
            <time class="post-time" title="2017年03月18日 18:26" datetime="2017-03-18T10:26:58.000Z"  itemprop="datePublished">2017-03-18</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/note/">note</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="spring知识点"><a href="#spring知识点" class="headerlink" title="spring知识点"></a>spring知识点</h1><p><a href="http://jinnianshilongnian.iteye.com/blog/1482071" target="_blank" rel="external">http://jinnianshilongnian.iteye.com/blog/1482071</a></p>
<h2 id="Spring注入方式"><a href="#Spring注入方式" class="headerlink" title="Spring注入方式"></a>Spring注入方式</h2><p>Spring注入是指在启动Spring容器加载bean配置的时候，完成对变量的赋值行为</p>
<ul>
<li>设值注入</li>
<li>构造注入</li>
</ul>
<h3 id="设值注入"><a href="#设值注入" class="headerlink" title="设值注入"></a>设值注入</h3><p>通过set方法进行注入</p>
<p><code>spring-injection.xml</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;injectionService&quot; class=&quot;com.imooc.ioc.injection.service.InjectionServiceImpl&quot;&gt; --&gt;</div><div class="line">	&lt;property name=&quot;injectionDAO&quot; ref=&quot;injectionDAO&quot;&gt;&lt;/property&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line"></div><div class="line">&lt;bean id=&quot;injectionDAO&quot; class=&quot;com.imooc.ioc.injection.dao.InjectionDAOImpl&quot;&gt;&lt;/bean&gt;</div></pre></td></tr></table></figure></p>
<p><code>InjectionServiceImpl.java</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//设值注入</div><div class="line">public void setInjectionDAO(InjectionDAO injectionDAO) &#123;</div><div class="line">	this.injectionDAO = injectionDAO;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="构造注入"><a href="#构造注入" class="headerlink" title="构造注入"></a>构造注入</h3><p>使用显示构造器来完成注入,构造器参数必须与配置文件的名字相同</p>
<p><code>spring-injection.xml</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;bean id=&quot;injectionService&quot; class=&quot;com.imooc.ioc.injection.service.InjectionServiceImpl&quot;&gt;</div><div class="line">	&lt;constructor-arg name=&quot;injectionDAO&quot; ref=&quot;injectionDAO&quot;&gt;&lt;/constructor-arg&gt;</div><div class="line">&lt;/bean&gt;</div><div class="line">&lt;bean id=&quot;injectionDAO&quot; class=&quot;com.imooc.ioc.injection.dao.InjectionDAOImpl&quot;&gt;&lt;/bean&gt;</div></pre></td></tr></table></figure></p>
<p><code>InjectionServiceImpl.java</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//构造器注入</div><div class="line">//public InjectionServiceImpl(InjectionDAO injectionDAO1)无法实现注入</div><div class="line">public InjectionServiceImpl(InjectionDAO injectionDAO) &#123;</div><div class="line">	this.injectionDAO = injectionDAO;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Bean的配置项"><a href="#Bean的配置项" class="headerlink" title="Bean的配置项"></a>Bean的配置项</h2><ul>
<li>Id：IOC容器中的唯一标示</li>
<li>Class：具体事例化的哪一个类</li>
<li>Scope：作用域，范围</li>
<li>Constructor arguments：构造器参数</li>
<li>Properties：属性</li>
<li>Autowiring mode：自动装配模式</li>
<li>lazy-initialization mode：懒加载模式</li>
<li>Initialization/destruction method：初始化/销毁方法</li>
</ul>
<h2 id="Bean作用域"><a href="#Bean作用域" class="headerlink" title="Bean作用域"></a>Bean作用域</h2><ul>
<li>singleton：单例，一个Bean容器只存在一份，比如一个context中存在一份，<strong>spring会缓存</strong></li>
<li>prototype：每次请求都会创建新的实例，destroy方式不生效,<strong>spring不会缓存</strong></li>
<li>request：每次http请求创建一个实例且尽在当前request内有效</li>
<li>session：同上，每次http请求创建，当前session内有效</li>
<li>global session：基于portlet(portlet可以登录多个系统定义了global session)的web中有效</li>
</ul>
<h2 id="Bean的生命周期"><a href="#Bean的生命周期" class="headerlink" title="Bean的生命周期"></a>Bean的生命周期</h2><ul>
<li>定义</li>
<li>初始化</li>
<li>使用</li>
<li>销毁</li>
</ul>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><ul>
<li>实现<code>import org.springframework.beans.factory.InitializingBean</code>接口，覆盖<code>afterPropertiesSet</code>方法</li>
<li>配置<code>init-method</code></li>
</ul>
<h3 id="销毁"><a href="#销毁" class="headerlink" title="销毁"></a>销毁</h3><ul>
<li>实现<code>import org.springframework.beans.factory.DisposableBean</code>接口，覆盖<code>destroy</code>方法</li>
<li>配置<code>destroy-method</code></li>
</ul>
<h3 id="配置全局的初始化销毁方法"><a href="#配置全局的初始化销毁方法" class="headerlink" title="配置全局的初始化销毁方法"></a>配置全局的初始化销毁方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</div><div class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</div><div class="line">        default-init-method=&quot;defautInit&quot; default-destroy-method=&quot;defaultDestroy&quot;&gt;</div></pre></td></tr></table></figure>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p><code>BeanLifeCycle.java</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//实现了接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanLifeCycle</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span>, <span class="title">DisposableBean</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//全局配置</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">defautInit</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Bean defautInit."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">defaultDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Bean defaultDestroy."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//实现接口</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Bean destroy."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Bean afterPropertiesSet."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//配置文件</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Bean start ."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stop</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Bean stop."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>spring-lifecycle.xml</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans</span></div><div class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd"</div><div class="line"></div><div class="line">        <span class="attr">default-init-method</span>=<span class="string">"defautInit"</span> <span class="attr">default-destroy-method</span>=<span class="string">"defaultDestroy"</span>&gt;</div><div class="line"></div><div class="line">        <span class="comment">&lt;!--配置文件--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"beanLifeCycle"</span> <span class="attr">class</span>=<span class="string">"com.imooc.lifecycle.BeanLifeCycle"</span>  </span></div><div class="line">        <span class="attr">init-method</span>=<span class="string">"start"</span> <span class="attr">destroy-method</span>=<span class="string">"stop"</span>&gt;<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"> <span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>优先级：实现接口 &gt; 配置文件 &gt; 全局配置</strong><br>在全局配置中的方法没有或者实现，其他两者不可以</p>
<h2 id="Aware"><a href="#Aware" class="headerlink" title="Aware"></a>Aware</h2><ul>
<li>Spring中提供了一些以<code>Aware</code>结尾的接口，实现了Aware接口的bean在被初始化后，可以获取相应的资源</li>
<li>通过Aware接口，可以对Spring相应资源进行操作</li>
<li>为对Spring进行简单的扩展提供了方便的入口</li>
</ul>
<p><code>MoocBeanName.java</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MoocBeanName</span> <span class="keyword">implements</span> <span class="title">BeanNameAware</span>, <span class="title">ApplicationContextAware</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> String beanName;</div><div class="line"></div><div class="line">	<span class="comment">//实现BeanNameAware方法</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.beanName = name;</div><div class="line">		System.out.println(<span class="string">"MoocBeanName : "</span> + name);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">//实现ApplicationContextAware的方法</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span></span></div><div class="line">			<span class="keyword">throws</span> BeansException &#123;</div><div class="line">		System.out.println(<span class="string">"setApplicationContext : "</span> + applicationContext.getBean(<span class="keyword">this</span>.beanName).hashCode());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>spring-aware.xml</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</div><div class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot; &gt;</div><div class="line">	&lt;bean id=&quot;moocBeanName&quot; class=&quot;com.imooc.aware.MoocBeanName&quot; &gt;&lt;/bean&gt;       </div><div class="line"> &lt;/beans&gt;</div></pre></td></tr></table></figure></p>
<h2 id="Bean的自动装配-Autowiring"><a href="#Bean的自动装配-Autowiring" class="headerlink" title="Bean的自动装配(Autowiring)"></a>Bean的自动装配(Autowiring)</h2><p>不需要配置属性set或者constructor，完成Bean的注入</p>
<ul>
<li>No<br>不要任何操作</li>
<li>byName<br>根据属性名自动装配。此选项经检查容器并根据名字查找与属性完全一致的bean，并将其与属性自动装配</li>
<li>byType<br>如果容器中存在一个与指定属性类型相同的bean，那么将与该属性自动装配；<br>如果存在多个该类型的bean，那么抛出异常，并指出不能使用byType方式进行自动装配；<br>如果没有找到相匹配的bean，什么事也不发生<br><strong>配置bean时可以没有id</strong></li>
<li>Constructor<br>与byType方式类似，不同之处在于它应用于构造器参数<br>如果没有找到与构造器参数类型一致的bean，那么抛出异常</li>
</ul>
<h3 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h3><p><code>spring-autowiring.xml</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</div><div class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</div><div class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</div><div class="line">        default-autowire=&quot;constructor&quot;&gt;</div><div class="line">        &lt;!--default-autowire上面说的几种方法--&gt;</div><div class="line">        &lt;bean id=&quot;autoWiringService&quot; class=&quot;com.imooc.autowiring.AutoWiringService&quot; &gt;&lt;/bean&gt;</div><div class="line">        &lt;bean class=&quot;com.imooc.autowiring.AutoWiringDAO&quot; &gt;&lt;/bean&gt;</div><div class="line"> &lt;/beans&gt;</div></pre></td></tr></table></figure></p>
<p> <code>AutoWiringService.java</code><br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"> public class AutoWiringService &#123;</div><div class="line"></div><div class="line">	private AutoWiringDAO autoWiringDAO;</div><div class="line"></div><div class="line">	//构造器注入</div><div class="line">	public AutoWiringService(AutoWiringDAO autoWiringDAO) &#123;</div><div class="line">		System.out.println(&quot;AutoWiringService&quot;);</div><div class="line">		this.autoWiringDAO = autoWiringDAO;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//set注入</div><div class="line">	public void setAutoWiringDAO(AutoWiringDAO autoWiringDAO) &#123;</div><div class="line">		System.out.println(&quot;setAutoWiringDAO&quot;);</div><div class="line">		this.autoWiringDAO = autoWiringDAO;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void say(String word) &#123;</div><div class="line">		this.autoWiringDAO.say(word);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>AutoWiringDAO.java</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public class AutoWiringDAO &#123;</div><div class="line"></div><div class="line">	public void say(String word) &#123;</div><div class="line">		System.out.println(&quot;AutoWiringDAO : &quot; + word);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="ioc原理"><a href="#ioc原理" class="headerlink" title="ioc原理"></a>ioc原理</h1><p>一篇记录读tiny-spring的文章<br><a href="https://github.com/duyao/tiny-spring" target="_blank" rel="external">https://github.com/duyao/tiny-spring</a></p>
<p><a href="https://www.zybuluo.com/dugu9sword/note/382745" target="_blank" rel="external">https://www.zybuluo.com/dugu9sword/note/382745</a></p>
<p><a href="https://my.oschina.net/flashsword/blog/192551" target="_blank" rel="external">https://my.oschina.net/flashsword/blog/192551</a><br><a href="https://my.oschina.net/flashsword/blog/194481" target="_blank" rel="external">https://my.oschina.net/flashsword/blog/194481</a></p>
<h2 id="BeanFactory-的构造与执行"><a href="#BeanFactory-的构造与执行" class="headerlink" title="BeanFactory 的构造与执行"></a>BeanFactory 的构造与执行</h2><p>BeanFactory 的核心方法是 getBean(String) 方法，用于从工厂中取出所需要的 Bean 。AbstractBeanFactory 规定了基本的构造和执行流程。</p>
<p>getBean 的流程：包括实例化和初始化，也就是生成 Bean，再执行一些初始化操作。</p>
<p>1.doCreateBean ：实例化 Bean。<br>  a.createInstance ：生成一个新的实例。</p>
<p>  b.applyProperties ：注入属性，包括依赖注入的过程。在依赖注入的过程中，如果 Bean 实现了 BeanFactoryAware 接口，则将容器的引用传入到 Bean 中去，这样，Bean 将获取对容器操作的权限，也就允许了 编写扩展 IoC 容器的功能的 Bean。</p>
<p>2.initializeBean(bean) ： 初始化 Bean。<br>  a. 从 BeanPostProcessor 列表中，依次取出 BeanPostProcessor 执行 bean = postProcessBeforeInitialization(bean,beanName) 。（为什么调用 BeanPostProceesor 中提供方法时，不是直接 post…(bean,beanName) 而是 bean = post…(bean,beanName) 呢？见分析1 。另外，BeanPostProcessor 列表的获取有问题，见分析2。）<br>  b. 初始化方法（tiny-spring 未实现对初始化方法的支持）。<br>  c. 从 BeanPostProcessor 列表中， 依次取出 BeanPostProcessor 执行其 bean = postProcessAfterInitialization(bean,beanName)。</p>
<h2 id="ApplicationContext-的构造和执行"><a href="#ApplicationContext-的构造和执行" class="headerlink" title="ApplicationContext 的构造和执行"></a>ApplicationContext 的构造和执行</h2><p>ApplicationContext 的核心方法是 refresh() 方法，用于从资源文件加载类定义、扩展容器的功能。</p>
<p>refresh 的流程：</p>
<p>总体来说，tiny-spring 的 ApplicaitonContext 使用流程是这样的：</p>
<p>1.loadBeanDefinitions(BeanFactory) ：<br>  类定义的读取和加载，并注入到内置的 BeanFactory 中，这里的可扩展性在于，未对加载方法进行要求，也就是可以从不同来源的不同类型的资源进行加载。</p>
<p>2.registerBeanPostProcessors(BeanFactory) ：<br>  获取所有的 BeanPostProcessor，并注册到 BeanFactory 维护的 BeanPostProcessor 列表去。</p>
<p>3.onRefresh ：<br>  a. preInstantiateSingletons ：以单例的方式，初始化所有 Bean。通过<strong>主动调用 getBean </strong> （见上面get过程） 实例化、注入属性、然后初始化 BeanFactory 中所有的 Bean。由于所有的 BeanPostProcessor 都已经在第 2 步中完成实例化了，因此接下来实例化的是普通 Bean，因此普通 Bean 的初始化过程可以正常执行。</p>
<p>BeanPostProcessor是Spring容器的一个扩展点，可以进行自定义的实例化、初始化、依赖装配、依赖检查等流程，即可以覆盖默认的实例化，也可以增强初始化、依赖注入、依赖检查等流程</p>
<h1 id="AOP（Aspect-Orient-Programming）"><a href="#AOP（Aspect-Orient-Programming）" class="headerlink" title="AOP（Aspect Orient Programming）"></a>AOP（Aspect Orient Programming）</h1><p>AOP（Aspect Orient Programming），也就是面向方面编程，作为面向对象编程的一种补充，专门用于处理系统中分布于各个模块（不同方法）中的交叉关注点的问题，在 Java EE 应用中，常常通过 AOP 来处理一些具有横切性质的系统级服务，如事务管理、安全检查、缓存、对象池管理等。<br>AOP 实现的关键就在于 AOP 框架自动创建的 AOP 代理，AOP 代理主要分为静态代理(预编译)和动态代理(运行期间)两大类，静态代理以 AspectJ 为代表；而动态代理则以 Spring AOP 为代表。</p>
<h2 id="SpringAOP"><a href="#SpringAOP" class="headerlink" title="SpringAOP"></a>SpringAOP</h2><p>与 AspectJ 相同的是，Spring AOP 同样需要对目标类进行增强，也就是生成新的 AOP 代理类；<br>与 AspectJ 不同的是，<strong>Spring AOP 无需使用任何特殊命令对 Java 源代码进行编译，它采用运行时动态地、在内存中临时生成“代理类”的方式来生成 AOP 代理。</strong><br>Spring 允许使用 AspectJ Annotation 用于定义方面（Aspect）、切入点（Pointcut）和增强处理（Advice），Spring 框架则可识别并根据这些 Annotation 来生成 AOP 代理。Spring 只是使用了和 AspectJ 5 一样的注解，但<strong>并没有使用 AspectJ 的编译器或者织入器（Weaver）</strong> ，底层依然使用的是 Spring AOP，依然是在运行时动态生成 AOP 代理，并不依赖于 AspectJ 的编译器或者织入器。</p>
<p>简单地说，<strong>Spring 依然采用运行时生成动态代理的方式来增强目标对象，所以它不需要增加额外的编译，也不需要 AspectJ 的织入器支持</strong>；而 AspectJ 在采用编译时增强，所以 AspectJ 需要使用自己的编译器来编译 Java 文件，还需要织入器。</p>
<p>不是为了提供强大的aop服务(AspectJ)，而侧重于提供与spring相关的基本aop服务</p>
<p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-springaopcglib/#ibm-pcon" target="_blank" rel="external">https://www.ibm.com/developerworks/cn/java/j-lo-springaopcglib/#ibm-pcon</a></p>
<h3 id="一些概念"><a href="#一些概念" class="headerlink" title="一些概念"></a>一些概念</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://7xilc8.com1.z0.glb.clouddn.com/aop.png" alt="AOP概念" title="">
                </div>
                <div class="image-caption">AOP概念</div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://7xilc8.com1.z0.glb.clouddn.com/advice-charater.png" alt="Advice类型" title="">
                </div>
                <div class="image-caption">Advice类型</div>
            </figure>
<h4 id="advice、pointcut、aspect"><a href="#advice、pointcut、aspect" class="headerlink" title="advice、pointcut、aspect"></a>advice、pointcut、aspect</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--这是一个切面，里面定义了切面要执行的逻辑，比如有after方法、before方法等--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"moocAspect"</span> <span class="attr">class</span>=<span class="string">"com.imooc.aop.schema.advice.MoocAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="comment">&lt;!--这一个普通的bean，这个bean希望有切面注入来实现一些功能--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"aspectBiz"</span> <span class="attr">class</span>=<span class="string">"com.imooc.aop.schema.advice.biz.AspectBiz"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!--首先声明一个切面--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"moocAspectAOP"</span> <span class="attr">ref</span>=<span class="string">"moocAspect"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--pointcut指出这个切面到底在哪里执行--&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.imooc.aop.schema.advice.biz.*Biz.*(..))"</span> <span class="attr">id</span>=<span class="string">"moocPiontcut"</span>/&gt;</span></div><div class="line">      <span class="comment">&lt;!--下面这些方法都是用来表示pointcut执行的时候到底使用的是切面的什么方法，在什么时候--&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">"before"</span> <span class="attr">pointcut-ref</span>=<span class="string">"moocPiontcut"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">"afterReturning"</span> <span class="attr">pointcut-ref</span>=<span class="string">"moocPiontcut"</span>/&gt;</span></div><div class="line">		  <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">"afterThrowing"</span> <span class="attr">pointcut-ref</span>=<span class="string">"moocPiontcut"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"after"</span> <span class="attr">pointcut-ref</span>=<span class="string">"moocPiontcut"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"around"</span> <span class="attr">pointcut-ref</span>=<span class="string">"moocPiontcut"</span>/&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">"aroundInit"</span> <span class="attr">pointcut</span>=<span class="string">"execution(* com.imooc.aop.schema.advice.biz.AspectBiz.init(String, int))</span></span></div><div class="line">						and args(bizName, times)"/&gt;</div><div class="line">	<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4><p>允许一个切面声明一个实现指定接口的通知对象，并且提供了一个接口实现类来代表这些对象<br><code>&lt;/aop:aspect&gt;</code>中<code>&lt;aop:declare-parents&gt;</code>元素声明该元素用于声明所匹配的类型拥有一个新的parent<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">id</span>=<span class="string">"moocAspectAOP"</span> <span class="attr">ref</span>=<span class="string">"moocAspect"</span>&gt;</span></div><div class="line">      <span class="comment">&lt;!--interface表示匹配者的新父接口，default-impl是父接口的实现类--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">aop:declare-parents</span> <span class="attr">types-matching</span>=<span class="string">"com.imooc.aop.schema.advice.biz.*(+)"</span></span></div><div class="line">    	<span class="attr">implement-interface</span>=<span class="string">"com.imooc.aop.schema.advice.Fit"</span></div><div class="line">    	<span class="attr">default-impl</span>=<span class="string">"com.imooc.aop.schema.advice.FitImpl"</span>/&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="Advisor"><a href="#Advisor" class="headerlink" title="Advisor"></a>Advisor</h4><p>advisor与aspect有相似的用法，通常与事务<code>&lt;tx:advice&gt;</code>一起使用<br>区别：<strong>advisor只持有一个Pointcut和一个advice</strong>，而aspect可以多个pointcut和多个advice<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--</span></div><div class="line">			propagation	:事务传播行为</div><div class="line">			isolation	:事务的隔离级别</div><div class="line">			read-only	:只读</div><div class="line">			rollback-for:发生哪些异常回滚</div><div class="line">			no-rollback-for	:发生哪些异常不回滚</div><div class="line">			timeout		:过期信息</div><div class="line">		 --&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"transfer"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 配置切面 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置切入点 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.zs.spring.demo3.AccountService+.*(..))"</span> <span class="attr">id</span>=<span class="string">"pointcut1"</span>/&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置切面 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut1"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="AspectJ"><a href="#AspectJ" class="headerlink" title="AspectJ"></a>AspectJ</h2><p>AspectJ 是一个基于 Java 语言的 AOP 框架，提供了强大的 AOP 功能，其他很多 AOP 框架都借鉴或采纳其中的一些思想。<br>AspectJ 是 Java 语言的一个 AOP 实现，其主要包括两个部分：<br>第一个部分定义了如何表达、定义 AOP 编程中的语法规范，通过这套语言规范，我们可以方便地用 AOP 来解决 Java 语言中存在的交叉关注点问题；<br>另一个部分是工具部分，包括编译器、调试工具等。<br>AspectJ 是最早、功能比较强大的 AOP 实现之一，对整套 AOP 机制都有较好的实现，很多其他语言的 AOP 实现，也借鉴或采纳了 AspectJ 中很多设计。在 Java 领域，AspectJ 中的很多语法结构基本上已成为 AOP 领域的标准。</p>
<h3 id="spring对AspectJ的支持"><a href="#spring对AspectJ的支持" class="headerlink" title="spring对AspectJ的支持"></a>spring对AspectJ的支持</h3><p><code>@AspectJ</code>类似于java注解<br>运行时仍然是存spring aop</p>
<h4 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h4><p><code>@AspectJ</code>切面使用<code>@Aspect</code>配置注解，该注解的类可以有方法和字段，可能含有切入点pointcut、通知advice和引入introduction<br><code>@Aspect</code>不能通过类路径自动检测，因此需要使用<code>@Component</code>注解或者在xml中配置bean</p>
<p>步骤：<br>1、在xml中开启<code>&lt;aop:aspectj-autoproxy&gt;&lt;/aop:aspectj-autoproxy&gt;</code><br>2、定义切面<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MoocAspect</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* com.imooc.aop.aspectj.biz.*Biz.*(..))"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointcut</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Pointcut</span>(<span class="string">"within(com.imooc.aop.aspectj.biz.*)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">bizPointcut</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="comment">//直接用已经定义好的pointcut</span></div><div class="line">	<span class="meta">@Before</span>(<span class="string">"pointcut()"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Before."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Before</span>(<span class="string">"pointcut() &amp;&amp; args(arg)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithParam</span><span class="params">(String arg)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"BeforeWithParam."</span> + arg);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Before</span>(<span class="string">"pointcut() &amp;&amp; @annotation(moocMethod)"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeWithAnnotaion</span><span class="params">(MoocMethod moocMethod)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"BeforeWithAnnotation."</span> + moocMethod.value());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@AfterReturning</span>(pointcut=<span class="string">"bizPointcut()"</span>, returning=<span class="string">"returnValue"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturning</span><span class="params">(Object returnValue)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"AfterReturning : "</span> + returnValue);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@AfterThrowing</span>(pointcut=<span class="string">"pointcut()"</span>, throwing=<span class="string">"e"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterThrowing</span><span class="params">(RuntimeException e)</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"AfterThrowing : "</span> + e.getMessage());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@After</span>(<span class="string">"pointcut()"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"After."</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Around</span>(<span class="string">"pointcut()"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Around 1."</span>);</div><div class="line">		Object obj = pjp.proceed();</div><div class="line">		System.out.println(<span class="string">"Around 2."</span>);</div><div class="line">		System.out.println(<span class="string">"Around : "</span> + obj);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="动态代理技术"><a href="#动态代理技术" class="headerlink" title="动态代理技术"></a>动态代理技术</h1><p>动态代理最常见应用是AOP(面向切面编程)。通过AOP，我们能够地拿到我们的程序运行到某个节点时的方法、对象、入参、返回参数，并动态地在方法调用前后新添一些新的方法逻辑，来满足我们的新需求，比如日志记录等。<br>动态代理常见有两种方式：基于JDK的反射技术的动态代理（必须是接口）和基于CGLib(任何类都可以，不一定是接口)的动态代理。</p>
<h2 id="JDK使用反射技术创建动态代理"><a href="#JDK使用反射技术创建动态代理" class="headerlink" title="JDK使用反射技术创建动态代理"></a>JDK使用反射技术创建动态代理</h2><p>JDK创建动态代理的核心是java.lang.reflect.InvocationHandler接口和java.lang.reflect.Proxy类。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//实现InvocationHandler接口</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkDynamicAopProxy</span> <span class="keyword">extends</span> <span class="title">AbstractAopProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JdkDynamicAopProxy</span><span class="params">(AdvisedSupport advised)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(advised);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="comment">//重写方法</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getProxy</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> Proxy.newProxyInstance(getClass().getClassLoader(), advised.getTargetSource().getInterfaces(), <span class="keyword">this</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line"><span class="comment">//重写调用方法</span></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(<span class="keyword">final</span> Object proxy, <span class="keyword">final</span> Method method, <span class="keyword">final</span> Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">		MethodInterceptor methodInterceptor = advised.getMethodInterceptor();</div><div class="line">		<span class="keyword">if</span> (advised.getMethodMatcher() != <span class="keyword">null</span></div><div class="line">				&amp;&amp; advised.getMethodMatcher().matches(method, advised.getTargetSource().getTarget().getClass())) &#123;</div><div class="line">			<span class="keyword">return</span> methodInterceptor.invoke(<span class="keyword">new</span> ReflectiveMethodInvocation(advised.getTargetSource().getTarget(),</div><div class="line">					method, args));</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			<span class="keyword">return</span> method.invoke(advised.getTargetSource().getTarget(), args);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="CGLib动态代理基本原理"><a href="#CGLib动态代理基本原理" class="headerlink" title="CGLib动态代理基本原理"></a>CGLib动态代理基本原理</h2><p>CGLib——Code Generation Library，它是一个动态字节代码生成库，基于asm。使用CGLib时需要导入asm相关的jar包。而asm又是何方神圣？</p>
<p>asm是一个java字节码操纵框架，它能被用来动态生成类或者增强既有类的功能。ASM 可以直接产生二进制 class 文件，也可以在类被加载入 Java 虚拟机之前动态改变类行为。Java class 被存储在严格格式定义的 .class文件里，这些类文件拥有足够的元数据来解析类中的所有元素：类名称、方法、属性以及 Java 字节码（指令）。ASM从类文件中读入信息后，能够改变类行为，分析类信息，甚至能够根据用户要求生成新类。</p>
<p>用JDK的动态代理来模拟实现了一个性能监控的例子，用到了JDK内置的反射技术和java.lang.reflect.Proxy代理类<br>通过例子我们发现，它<strong>只能通过让被代理类实现代理接口的方式来生成代理</strong>，而CGLib的区别在于<strong>通过在程序运行时动态生成一个被代理类的子类的方式来完成代理</strong>。</p>
<p>CGLib有几个核心类:</p>
<ol>
<li>Enhancer 它用于动态生成被代理的类的子类。使用此类生成子类的前奏是指定被代理类和指定CallBack接口</li>
<li>CallBack：它是一个很关键的接口，我们常常通过CallBack接口来配置我们的拦截方法，</li>
<li>MethodInterceptor：是CallBack的实现类，他会拦截我们被代理类的所有方法，来实现自己的增强细节。比如做点日志记录，方法处理等，处理完后，还能通过MethodProxy重新调用拦截掉的方法。</li>
<li>MethodProxy：主要用于重新调用MethodInterceptor拦截掉的方法，是jdk反射包中Method的代理类。</li>
<li>CallbackFilter：一个Enhancer生成类可以指定多个Callback,这样我们可以设定条件过滤，让被代理类中不同的方法被调用时使用不同的CallBack来进行处理。<br><a href="https://yq.aliyun.com/articles/29130?spm=5176.8091938.0.0.kpT4Os" target="_blank" rel="external">https://yq.aliyun.com/articles/29130?spm=5176.8091938.0.0.kpT4Os</a><br><a href="https://yq.aliyun.com/articles/29131?spm=5176.8091938.0.0.kpT4Os" target="_blank" rel="external">https://yq.aliyun.com/articles/29131?spm=5176.8091938.0.0.kpT4Os</a></li>
</ol>
<h1 id="事务管理"><a href="#事务管理" class="headerlink" title="事务管理"></a>事务管理</h1><h2 id="PlatformTransactionManager事务管理器"><a href="#PlatformTransactionManager事务管理器" class="headerlink" title="PlatformTransactionManager事务管理器"></a>PlatformTransactionManager事务管理器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function">TransactionStatus <span class="title">getTransaction</span><span class="params">(TransactionDefinition definition)</span> <span class="keyword">throws</span> TransactionException</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException</span>;</div></pre></td></tr></table></figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://7xilc8.com1.z0.glb.clouddn.com/spring-datasource.png" alt="PlatformTransactionManager实现类" title="">
                </div>
                <div class="image-caption">PlatformTransactionManager实现类</div>
            </figure>
<h2 id="TransactionDefinition事务定义信息"><a href="#TransactionDefinition事务定义信息" class="headerlink" title="TransactionDefinition事务定义信息"></a>TransactionDefinition事务定义信息</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//主要方法</span></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span></span>;</div><div class="line"><span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</div><div class="line">TIMEOUT_DEFAULT</div></pre></td></tr></table></figure>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><p>//事务隔离级别<br>ISOLATION_DEFAULT//默认的隔离级别，默认值为后台所使用的数据库的隔离级别，比如mysql是rr<br>ISOLATION_READ_UNCOMMITTED<br>ISOLATION_READ_COMMITTED<br>ISOLATION_REPEATABLE_READ<br>ISOLATION_SERIALIZABLE</p>
<p>不同的事务隔离级别可能会引发的问题：<br>脏读：一个事务读取了另一个事务改写但还未提交的数据，如果这个数据被回滚，则读到的数据是无效的<br>不可重复读：在同一个事务中，多次读取同一个数据，而返回的结果是不一致的<br>幻读：一个事务读取了几行记录后，后一个事务插入一些记录，幻读就发生了。再后来的查询中，第一个事务就会发现原来有些没有的记录。</p>
<table>
<thead>
<tr>
<th></th>
<th style="text-align:center">脏读</th>
<th style="text-align:center">不可重复读</th>
<th style="text-align:center">幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td>未提交读</td>
<td style="text-align:center">Y</td>
<td style="text-align:center">Y</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td>提交读</td>
<td style="text-align:center">N</td>
<td style="text-align:center">Y</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td>可重复读</td>
<td style="text-align:center">N</td>
<td style="text-align:center">N</td>
<td style="text-align:center">Y</td>
</tr>
<tr>
<td>可串行化</td>
<td style="text-align:center">N</td>
<td style="text-align:center">N</td>
<td style="text-align:center">N</td>
</tr>
</tbody>
</table>
<h3 id="事务的传播特性"><a href="#事务的传播特性" class="headerlink" title="事务的传播特性"></a>事务的传播特性</h3><p>事务的传播行为：解决业务层方法之间相互调用的问题<br>比如有一个serviceA需要使用dao1.x()和dao2.y(),serviceB需要使用dao1.y()和dao2.x(),serviceC需要使用serviceA和serviceB来完成业务，那么事务的传播就来解决serviceC中事务的行为的<br><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://7xilc8.com1.z0.glb.clouddn.com/transaction_propagation.png" alt="事务的传播特性" title="">
                </div>
                <div class="image-caption">事务的传播特性</div>
            </figure><br>其实主要分为3类：<br>第一类是支持支持当前事务，也就是说当前事务和新事务是在同一个事务中的<br>第二类是不和当前事务混在一起，各走各的<br>第三类是嵌套</p>
<h2 id="TransactionStatus事务状态信息"><a href="#TransactionStatus事务状态信息" class="headerlink" title="TransactionStatus事务状态信息"></a>TransactionStatus事务状态信息</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isNewTransaction</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">hasSavepoint</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">setRollbackOnly</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isRollbackOnly</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isCompleted</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<h2 id="配置声明式事务"><a href="#配置声明式事务" class="headerlink" title="配置声明式事务"></a>配置声明式事务</h2><h3 id="xml方式"><a href="#xml方式" class="headerlink" title="xml方式"></a>xml方式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置业务层类 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountService"</span> <span class="attr">class</span>=<span class="string">"com.zs.spring.demo3.AccountServiceImpl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"accountDao"</span> <span class="attr">ref</span>=<span class="string">"accountDao"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置DAO类(简化，会自动配置JdbcTemplate) --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"accountDao"</span> <span class="attr">class</span>=<span class="string">"com.zs.spring.demo3.AccountDaoImpl"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- ==================================使用XML配置声明式的事务管理,基于tx/aop=============================================== --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置事务的通知 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">"txAdvice"</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!--</span></div><div class="line">			propagation	:事务传播行为</div><div class="line">			isolation	:事务的隔离级别</div><div class="line">			read-only	:只读</div><div class="line">			rollback-for:发生哪些异常回滚</div><div class="line">			no-rollback-for	:发生哪些异常不回滚</div><div class="line">			timeout		:过期信息</div><div class="line">		 --&gt;</div><div class="line">      <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">"transfer"</span> <span class="attr">propagation</span>=<span class="string">"REQUIRED"</span> <span class="attr">isolation</span>=<span class="string">"SERIALIZABLE"</span> <span class="attr">read-only</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置切面 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置切入点 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.zs.spring.demo3.AccountService+.*(..))"</span> <span class="attr">id</span>=<span class="string">"pointcut1"</span>/&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置切面 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"txAdvice"</span> <span class="attr">pointcut-ref</span>=<span class="string">"pointcut1"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div></pre></td></tr></table></figure>
<p>无需更改service的代码，就可以完成事务的操作</p>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- ==================================4.使用注解配置声明式事务============================================ --&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置事务管理器 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"transactionManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 开启注解事务 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">"transactionManager"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>service中的方法前面加上注解<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Transactional</span>(propagation = Propagation.REQUIRED,isolation = Isolation.REPEATABLE_READ,readOnly = <span class="keyword">true</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myTransaction</span><span class="params">()</span> </span>&#123;</div><div class="line">  ...</div><div class="line">  System.out.println(<span class="string">"myTransaction...  "</span> ));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="一些问题"><a href="#一些问题" class="headerlink" title="一些问题"></a>一些问题</h1><h2 id="spring为什么默认为单例"><a href="#spring为什么默认为单例" class="headerlink" title="spring为什么默认为单例"></a>spring为什么默认为单例</h2><blockquote>
<p>When a bean is a singleton, only one shared instance of the bean will be managed and all requests for beans with an id or ids matching that bean definition will result in that one specific bean instance being returned.</p>
</blockquote>
<p>spring中的单例和设计模式中的单例是不一样的，在spring中单例意味着每一个bean只有一个实例<br>一是我们不用每次创建bean，这样可以减小开销，提高性能<br>二是减少了对象创建和垃圾收集的时间</p>
<p><a href="http://stackoverflow.com/questions/21828664/why-spring-bean-is-singleton-scope" target="_blank" rel="external">http://stackoverflow.com/questions/21828664/why-spring-bean-is-singleton-scope</a></p>
<h2 id="spring保证线程安全吗"><a href="#spring保证线程安全吗" class="headerlink" title="spring保证线程安全吗"></a>spring保证线程安全吗</h2><p>不保证，spring的bean是单例的，但不一定是线程安全的，单例与线程安全无必然联系<br>spring中bean还是无状态的,ejb是两者都有。<br>Stateless无状态用单例Singleton模式，Stateful有状态就用原型Prototype模式。<br>Stateful 有状态是多线程编码的天敌，所以在开发中尽量用Stateless无状态，无状态是不变(immutable)模式的应用，有很多优点：不用管线程和同步的问题，如果值是不可变的，程序不用担心多个线程改变共享状态，所以可以避免线程竞争的bugs. 因为没有竞争，就不用用locks等机制，所以无状态的不变机制，也可以避免产生死锁现象。<br>有状态就是有数据存储功能。有状态对象(Stateful Bean)，就是有实例变量的对象，可以保存数据，是非线程安全的。在不同方法调用间不保留任何状态。<br>无状态就是一次操作，不能保存数据。无状态对象(Stateless Bean)，就是没有实例变量的对象.不能保存数据，是不变类，是线程安全的。<br><a href="http://www.moosepp.top/2016/08/21/%E6%9C%89%E7%8A%B6%E6%80%81bean%E5%92%8C%E6%97%A0%E7%8A%B6%E6%80%81bean%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3/" target="_blank" rel="external">http://www.moosepp.top/2016/08/21/%E6%9C%89%E7%8A%B6%E6%80%81bean%E5%92%8C%E6%97%A0%E7%8A%B6%E6%80%81bean%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3/</a></p>
<p>我们知道在一般情况下，只有无状态的Bean才可以在多线程环境下共享，在Spring中，绝大部分Bean都可以声明为singleton作用域。<br>就是因为Spring对一些Bean（如RequestContextHolder、TransactionSynchronizationManager、LocaleContextHolder等）中非线程安全的“状态性对象”采用<strong>ThreadLocal</strong>进行封装，让它们也成为线程安全的“状态性对象”，因此有状态的Bean就能够以singleton的方式在多线程中正常工作了。<br>或者浅显的解决办法就是将多态bean的作用域由“singleton”变更为“prototype”。</p>
<p>How to Make/Design a Thread Safe “Object”?<br>无状态、不变、<br>Design your beans immutable: for example have no setters and only use constructor arguments to create a bean. There are other ways, such as Builder pattern, etc..<br>Design your beans stateless: for example a bean that does something can be just a function (or several). This bean in most cases can and should be stateless, which means it does not have any state, it only does things with function arguments you provide each time (on each invocation)</p>
<p><a href="http://stackoverflow.com/questions/15745140/are-spring-objects-thread-safe" target="_blank" rel="external">http://stackoverflow.com/questions/15745140/are-spring-objects-thread-safe</a></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-05-13T14:35:16.000Z" itemprop="dateUpdated">2017年5月13日 22:35</time>
</span><br>


        转载请注明来自于:<a href="/2017/03/18/spring-ioc-aop/" target="_blank" rel="external">http://duyao.github.io/2017/03/18/spring-ioc-aop/</a>
    </div>
    <footer>
        <a href="http://duyao.github.io">
            <img src="/img/yao.png" alt="Du Yao">
            Du Yao
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spring/">spring</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://duyao.github.io/2017/03/18/spring-ioc-aop/&title=《spring-ioc & aop》 — Du Yao's blog&pic=http://duyao.github.io/img/yao.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://duyao.github.io/2017/03/18/spring-ioc-aop/&title=《spring-ioc & aop》 — Du Yao's blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://duyao.github.io/2017/03/18/spring-ioc-aop/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《spring-ioc & aop》 — Du Yao's blog&url=http://duyao.github.io/2017/03/18/spring-ioc-aop/&via=http://duyao.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://duyao.github.io/2017/03/18/spring-ioc-aop/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/03/19/Servlet-Cookie-Session/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Servlet, Cookie &amp; Session</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/03/17/IO相关/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">IO相关</h4>
      </a>
    </div>
  
</nav>



    

<div class="comments" id="comments">
    <div class="ds-thread" data-thread-key="spring-ioc-aop" data-title="spring-ioc & aop" data-url="http://duyao.github.io/2017/03/18/spring-ioc-aop/"></div>
</div>
<script>
lazyScripts.push('//cdn.bootcss.com/marked/0.3.6/marked.min.js');

var duoshuoQuery = {short_name:'ysblog', theme: 'none'};
lazyScripts.push('/js/embed.min.js?v=1.4.8');


</script>







</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            <span>博客内容遵循 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p>
            <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span>
            <span>Du Yao's blog &copy; 2015 - 2017</span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://duyao.github.io/2017/03/18/spring-ioc-aop/&title=《spring-ioc & aop》 — Du Yao's blog&pic=http://duyao.github.io/img/yao.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://duyao.github.io/2017/03/18/spring-ioc-aop/&title=《spring-ioc & aop》 — Du Yao's blog&source=" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://duyao.github.io/2017/03/18/spring-ioc-aop/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《spring-ioc & aop》 — Du Yao's blog&url=http://duyao.github.io/2017/03/18/spring-ioc-aop/&via=http://duyao.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://duyao.github.io/2017/03/18/spring-ioc-aop/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aUW4CMQwFQO5/aXoAyvJsh6qbTL6QukAmSK7t+PGI1/NlvXum+vy7dz2+sTAwMG7LeF6uZFvJu16p10eQ7w0DA+McRv7R119QPaAkBF/vDQMDA+P6mV6qV00xMTAwMCYBNy8+r0kYGBgYCSMpYntlZ8LOi+cFtTgGBsYNGXnX/e9ff+V+AwMD41aMZ3H1UrpqiCzvCgMDY2vGvJW2qqCdt/YwMDBOYPRGKPJ3JUlnfigfanEMDIztGFHbPW6l5QlffijNdBMDA2M7RrWInVxn9lLGaFwDAwNjO0ZyrfiNvyZhuvA7YGBgHMOoNuV74TIZ6cgPCAMD4zRGdbvVFtuqpt4vrzEwMLZm5KG2l+RNQnb1EhQDA2NXxqqmfH5h0GvhFcYsMDAwtmP02l7fKFaTrTdHKzAwMLZgRMVhHDTzMa9Joy0KuxgYGFsw1haW+fjFqlCLgYFxAqP6odXyctLuLx8rBgbGAYze4EXveiC/tcgbeRgYGKcxJgE3D5q9Pbx9BgMD4wBG9WKgmupVpz+qJAwMjNMY8wSuOZsWN/KW1eIYGBj/nvEsrnnrbXHhmlfbGBgYt2UsiNbxF0yGM6pFMgYGxn6MJMj2mnHVTY8CLgYGxgGMfEO9AdZe6pnvFgMDA2My7NVrzJUTUAwMDIxBoz9JFvOh1Q9FLAYGxtaMpIjNQ2re25skiBgYGOcwqqXjpAStjnRM/g1gYGBswfgBPsfk88nDL8UAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };



</script>

<script src="/js/main.min.js?v=1.4.8"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.4.8" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


</body>
</html>
